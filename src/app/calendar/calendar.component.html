<h1 class="hideForPrint"> Planning </h1>

<div class="alert-changes" *ngIf="displayChangesMsg">Des modifications ont été détecté. Voulez-vous les sauvegarder ?
    <button type="button" class="btn btn-link" (click)="saveChanges()">Oui</button>
    ou
    <button type="button" class="btn btn-link" (click)="clearChanges()">Non</button>
</div>
<div *ngIf="displayChangesMsg"> Modifications :
    <p *ngFor="let event of eventChangesList">
        Evènement n°{{event.id}} - Le {{event.date}} - De {{event.startHour}} à {{event.endHour}} | Conducteur :
        {{event.driver.firstname}}
    </p>
</div>

<div class="row" style="margin-bottom: 2%;">
    <div class="col hideForPrint">
        <div class="row">
            <button type="button" class="btn btn-info" (click)="displayEventForm(true)"> Ajouter un event</button>
            <button type="button" class="btn btn-info" (click)="displayFilterForm(true)"> Filtrer</button>
        </div>
    </div>
</div>

<form [formGroup]="filterForm" (ngSubmit)="onFilterSubmit()" *ngIf="displayFilteredForm">
    <div class="row">
        <div class="col-10">
            <h3>Filtrer le planning</h3>
        </div>
        <div class="col-2">
            <button type="button" class="btn btn-link" (click)="clearFilterForm()">Fermer</button>
        </div>
    </div>

    <div class="row">
        <div class="col-3">
            <label for="driver">Conducteur 1 : </label>
            <select formControlName="driver1" id="driver1" [(ngModel)]="selectedFilteredDriverId1">
                <option *ngFor="let driver of driverList" [value]="driver.id">
                    {{driver.firstname | lowercase }} {{driver.lastname | uppercase }}
                </option>
            </select>
        </div>
        <div class="col-3">
            <label for="driver">Conducteur 2 : </label>
            <select formControlName="driver2" id="driver2" [(ngModel)]="selectedFilteredDriverId2">
                <option *ngFor="let driver of driverList" [value]="driver.id">
                    {{driver.firstname | lowercase }} {{driver.lastname | uppercase }}
                </option>
            </select>
        </div>
        <div class="col">
            <label for="startHourFilterSelected"> De : </label>
            <select formControlName="startHourFilterSelected" id="startHourFilterSelected" [(ngModel)]="startHourFilterSelected" (change)="updateHoursJobFrom()">
                <option *ngFor="let hour of hours_job" [value]="hour">
                    {{hour}} h 00
                </option>
            </select>
        </div>
        <div class="col">
            <label for="endHourFilterSelected"> A : </label>
            <select formControlName="endHourFilterSelected" id="endHourFilterSelected" [(ngModel)]="endHourFilterSelected">
                <option *ngFor="let hour of hours_job_from" [value]="hour">
                    {{hour}} h 00
                </option>
            </select>
        </div>

    </div>
    <div class="row">
        <div style="color:red" *ngIf="!filterForm.valid && filterForm.touched">
            Veuillez rentrer des valeurs valides.
        </div>
        <button type="submit" class="btn btn-info" [disabled]="!filterForm.valid">Filtrer</button>
        <button type="button" class="btn btn-warning" (click)="clearFilter()">Effacer les filtres</button>

    </div>
</form>

<form [formGroup]="eventForm" (ngSubmit)="onSubmit()" *ngIf="displayForm">
    <div class="row">
        <div class="col-10">
            <h3 *ngIf="!updatingEvent">Ajouter un évènement</h3>
            <h3 *ngIf="updatingEvent">Editer un évènement</h3>
        </div>
        <div class="col-2">
            <button type="button" class="btn btn-link" (click)="clearEventForm()">Fermer</button>
        </div>
    </div>

    <div class="row">
        <div class="col-2">
            <label for="driver">Conducteur : </label>
            <select formControlName="driver" id="driver" [(ngModel)]="selectedDriverId">
                <option *ngFor="let driver of driverList" [value]="driver.id">
                    {{driver.firstname | lowercase }} {{driver.lastname | uppercase }}
                </option>
            </select>
        </div>
        <div class="col-2">
            <label for="patient">Patient : </label>
            <select formControlName="patient" id="patient" [(ngModel)]="selectedPatientId">
                <option *ngFor="let patient of patientList" [value]="patient.id">
                    {{patient.firstname | lowercase }} {{patient.lastname | uppercase }}
                </option>
            </select>
        </div>
        <div class="col">
            <label for="journey"> Trajet : </label>
            <div class="row">
                De :
                <div class="col">
                    <select formControlName="startPoint" id="startPoint" [(ngModel)]="selectedStartPointId">
                        <option *ngFor="let place of placeList" [value]="place.id">
                            {{place.label | uppercase }}
                        </option>
                    </select>
                </div>
                Vers :
                <div class="col">
                    <select formControlName="endPoint" id="endPoint" [(ngModel)]="selectedEndPointId">
                        <option *ngFor="let place of placeList" [value]="place.id">
                            {{place.label | uppercase }}
                        </option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-3">
            <label for="date">Date : </label>
            <input class="form-control" type="date" id="date" placeholder="jj/mm/aaaa" formControlName="date">
        </div>
        <div class="col-2">
            <label for="startHour">Départ : </label>
            <div class="input-group">
                <input class="form-control" type="time" id="startHour" formControlName="startHour"
                    [(ngModel)]="startHourSelected">
            </div>
        </div>
        <div class="col-2">
            <label for="endHour">Retour : </label>
            <input type="time" id="endHour" class="form-control" formControlName="endHour" [value]="startHourSelected">
        </div>
    </div>

    <div style="color:red" *ngIf="!eventForm.valid && eventForm.touched">
        Veuillez rentrer des valeurs valides.
    </div>
    <div class="col">
        <button type="submit" class="btn btn-info" [disabled]="!eventForm.valid">Valider</button>
    </div>

</form>


<div class="col eventDetails" *ngIf="displayEventClickedDetails">
    <div class="row">
        <div class="col-8">
            <h4>Evènement sélectionné</h4>
        </div>
        <div class="col">
            <button type="button" class="btn btn-link" (click)="displayEventClicked(false)">Fermer</button>
        </div>
    </div>

    <div class="row">
        <div class="col-2">
            <strong>Conducteur : </strong>
        </div>
        <div class="col">
            <p> {{eventClicked.driver.lastname}} {{eventClicked.driver.firstname}}</p>
        </div>
        <div class="col-2">
            <strong>Patient : </strong>
        </div>
        <div class="col">
            <p> {{eventClicked.patient.lastname}} {{eventClicked.patient.firstname}}</p>
        </div>
    </div>
    <div class="row">
        <div class="col-1">
            <strong>De : </strong>
        </div>
        <div class="col">
            <p> {{eventClicked.startPoint.label }}</p>
        </div>
        <div class="col-1">
            <strong>Vers : </strong>
        </div>
        <div class="col">
            <p> {{eventClicked.endPoint.label }}</p>
        </div>
    </div>
    <div class="row">
        <div class="col-3">
            <strong *ngIf="eventClicked.driver.comment !== null">Détails conducteur : </strong>
        </div>
        <div class="col">
            <p> {{eventClicked.driver.comment}}</p>
        </div>
        <div class="col-2">
            <strong *ngIf="eventClicked.patient.comment !== null">Détails patient : </strong>
        </div>
        <div class="col">
            <p> {{eventClicked.patient.comment}}</p>
        </div>
    </div>

    <button class="btn btn-info" (click)="editEvent(eventClicked)">Modifier</button>
    <button class="btn btn-danger" (click)="deleteEventById(eventClicked.id)">Supprimer</button>

</div>


<div class="printMe">
    <full-calendar #calendar [options]="calendarOptions"></full-calendar>
</div>