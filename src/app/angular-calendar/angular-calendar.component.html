<h1 class="title"> Planning </h1>

<app-calendar-header [(view)]="view" [(viewDate)]="viewDate">
</app-calendar-header>

<div class="alert alert-warning" *ngIf="period?.events.length === 0">
  Il n'y a aucun évènement sur cette vue : {{ view }}
</div>

<p> Display changes msg : {{displayChangesMsg}}</p>

<div class="alert alert-warning" *ngIf="displayChangesMsg">
  Des modifications ont été détecté. Voulez-vous les sauvegarder ?

</div>
<div *ngIf="displayChangesMsg"> Modifications :

</div>

<button mat-raised-button (click)="openDialog()">Open file</button>

<ng-template #weekViewHourSegmentTemplate let-segment="segment" let-locale="locale" let-segmentHeight="segmentHeight"
  let-isTimeLabel="isTimeLabel">
  <div #segmentElement class="cal-hour-segment" [style.height.px]="segmentHeight"
    [class.cal-hour-start]="segment.isStart" [class.cal-after-hour-start]="!segment.isStart"
    [ngClass]="segment.cssClass" (mousedown)="addEventOnClickInWeekView(segment, $event, segmentElement)">
    <div class="cal-time" *ngIf="isTimeLabel">
      {{ segment.date | calendarDate:'weekViewHour':locale }}
    </div>
  </div>
</ng-template>

<div [ngSwitch]="view">
  <mwl-calendar-month-view *ngSwitchCase="'month'" [viewDate]="viewDate" [events]="events"
    [activeDayIsOpen]="false" [locale]="locale" [weekStartsOn]="weekDayStartsOn" [weekendDays]="weekendDays"
    (dayClicked)="dayClicked($event.day)" (eventClicked)="eventClicked($event)" [refresh]="refresh"
    (eventTimesChanged)="eventTimesChanged($event)" (beforeViewRender)="beforeViewRender($event)">
  </mwl-calendar-month-view>

  <mwl-calendar-week-view *ngSwitchCase="'week'" [viewDate]="viewDate" [events]="events" [locale]="locale"
    [weekStartsOn]="weekDayStartsOn" [weekendDays]="weekendDays" [hourSegmentTemplate]="weekViewHourSegmentTemplate" [hourSegments]="4"
    dayStartHour="8" [refresh]="refresh"
    (eventClicked)="eventClicked($event)" (eventTimesChanged)="eventTimesChanged($event)"
    (beforeViewRender)="beforeViewRender($event)">
  </mwl-calendar-week-view>
  <mwl-calendar-day-view *ngSwitchCase="'day'" [viewDate]="viewDate" [events]="events" [locale]="locale"
  [dayStartHour]="7" [dayStartMinute]="0" 
  [hourSegments]="" [dayEndHour]="22" [dayEndMinute]="0" [refresh]="refresh"
    (eventClicked)="eventClicked($event)" (eventTimesChanged)="eventTimesChanged($event)"
    (beforeViewRender)="beforeViewRender($event)">
  </mwl-calendar-day-view>
</div>

<!-- Modal implementation -->
<ng-template #modalContent let-close="close">
  <div class="modal-header">
    <h5 *ngIf="!updatingEvent" class="modal-title">Ajouter un évènement</h5>
    <h5 *ngIf="updatingEvent" class="modal-title">Editer un évènement</h5>
    <button type="button" class="close" (click)="close()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="eventForm" (ngSubmit)="onSubmit()">
      <div class="row">
        <div class="col-6">
          <label for="driver">Conducteur : </label>
          <select formControlName="driver" id="driver" [(ngModel)]="selectedDriverId">
            <option *ngFor="let driver of driverList" [value]="driver.id">
              {{driver.firstname | lowercase }} {{driver.lastname | uppercase }}
            </option>
          </select>
        </div>
        <div class="col-6">
          <label for="patient">Patient : </label>
          <select formControlName="patient" id="patient" [(ngModel)]="selectedPatientId">
            <option *ngFor="let patient of patientList" [value]="patient.id">
              {{patient.firstname | lowercase }} {{patient.lastname | uppercase }}
            </option>
          </select>
        </div>
      </div>
        <div class="row">
          <div class="col-5">
            <label for="startPoint">De : </label>
              <select formControlName="startPoint" id="startPoint" [(ngModel)]="selectedStartPointId">
                <option *ngFor="let place of placeList" [value]="place.id">
                  {{place.label | uppercase }}
                </option>
              </select>
          </div>
          <div class="col-5">
            <label for="startPoint">Vers : </label>
              <select formControlName="endPoint" id="endPoint" [(ngModel)]="selectedEndPointId">
                <option *ngFor="let place of placeList" [value]="place.id">
                  {{place.label | uppercase }}
                </option>
              </select>
          </div>
        </div>

  <div style="color:red" *ngIf="!eventForm.valid && eventForm.touched">
    Veuillez rentrer des valeurs valides.
  </div>

  <div class="modal-footer">
    <button type="submit" class="btn btn-info" data-dismiss="modal" [disabled]="!eventForm.valid">Valider</button>
  </div>
  </form>
</div>

</ng-template>